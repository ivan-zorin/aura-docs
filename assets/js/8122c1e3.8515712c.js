"use strict";(self.webpackChunk_localzet_aura_docs=self.webpackChunk_localzet_aura_docs||[]).push([[5774],{7009:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"install/panel-security/caddy-with-custom-path","title":"Caddy with custom path","description":"Caddy is a powerful and flexible web server that can be used to secure your Aura panel.","source":"@site/docs/install/panel-security/caddy-with-custom-path.md","sourceDirName":"install/panel-security","slug":"/security/caddy-with-custom-path","permalink":"/docs/security/caddy-with-custom-path","draft":false,"unlisted":false,"editUrl":"https://github.com/localzet/aura-docs/tree/main/docs/install/panel-security/caddy-with-custom-path.md","tags":[],"version":"current","lastUpdatedBy":"Ivan Zorin","lastUpdatedAt":1750179473000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"slug":"/security/caddy-with-custom-path","title":"Caddy with custom path"},"sidebar":"tutorialSidebar","previous":{"title":"Caddy with minimal setup","permalink":"/docs/security/caddy-with-minimal-setup"},"next":{"title":"Cloudflare ZeroTrust","permalink":"/docs/security/cloudflare-zero-trust"}}');var t=s(4848),a=s(8453);const l={sidebar_position:2,slug:"/security/caddy-with-custom-path",title:"Caddy with custom path"},r=void 0,d={},c=[{value:"Installation",id:"installation",level:2},{value:"Configuring .env variables",id:"configuring-env-variables",level:2},{value:"Caddyfile",id:"caddyfile",level:2},{value:"Full security setup with MFA",id:"full",level:3},{value:"API routes without auth (api/*)",id:"minimal",level:3},{value:"/api/sub/* endpoints without auth",id:"minimal-with-opened-sub",level:3},{value:"Running the container",id:"running-the-container",level:2},{value:"Accessing the panel",id:"accessing-the-panel",level:2},{value:"Disable MFA",id:"disable-mfa",level:3},{value:"Accessing Auth Portal page",id:"accessing-auth-portal-page",level:2},{value:"Issuing API-keys",id:"issuing-api-keys",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Caddy is a powerful and flexible web server that can be used to secure your Aura panel."}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.p,{children:"First of all, create a directory for Caddy."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir -p /opt/aura/caddy && cd /opt/aura/caddy\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then create a ",(0,t.jsx)(n.code,{children:"docker-compose.yml"})," file."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"touch docker-compose.yml && nano docker-compose.yml\n"})}),"\n",(0,t.jsx)(n.p,{children:"And add the following content to the file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:"services:\r\n    aura-caddy:\r\n        image: aura/caddy-with-auth:latest\r\n        container_name: 'aura-caddy'\r\n        hostname: aura-caddy\r\n        restart: always\r\n        environment:\r\n            - AUTH_TOKEN_LIFETIME=3600\r\n            // highlight-next-line-red\r\n            - REMNAWAVE_PANEL_DOMAIN=PANEL_DOMAIN\r\n            // highlight-next-line-red\r\n            - REMNAWAVE_CUSTOM_LOGIN_ROUTE=supersecretroute\r\n            // highlight-next-line-red\r\n            - AUTHP_ADMIN_USER=LOGIN_USERNAME\r\n            // highlight-next-line-red\r\n            - AUTHP_ADMIN_EMAIL=LOGIN_EMAIL\r\n            // highlight-next-line-red\r\n            - AUTHP_ADMIN_SECRET=LOGIN_PASSWORD\r\n\r\n        ports:\r\n            - '0.0.0.0:443:443'\r\n        networks:\r\n            - aura-network\r\n        volumes:\r\n            - ./Caddyfile:/etc/caddy/Caddyfile\r\n            - aura-caddy-ssl-data:/data\r\n\r\nnetworks:\r\n    aura-network:\r\n        name: aura-network\r\n        driver: bridge\r\n        external: true\r\n\r\nvolumes:\r\n    aura-caddy-ssl-data:\r\n        driver: local\r\n        external: false\r\n        name: aura-caddy-ssl-data\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuring-env-variables",children:"Configuring .env variables"}),"\n",(0,t.jsx)(n.p,{children:"You need to set a domain name for your Aura panel. Caddy will automatically issue a certificate for it."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"REMNAWAVE_PANEL_DOMAIN=panel.domain.com\n"})}),"\n",(0,t.jsx)(n.p,{children:"Custom login route.\r\nThis path will be used ONLY for the login page. There will be no redirect if you open the dashboard without being previously authenticated.\r\nOnly people who know this path will be able to access the panel."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"REMNAWAVE_CUSTOM_LOGIN_ROUTE=supersecretroute\n"})}),"\n",(0,t.jsx)(n.p,{children:"Admin credentials.\r\nMake sure to use a strong password."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"AUTHP_ADMIN_USER=admin\r\nAUTHP_ADMIN_EMAIL=admin@domain.com\r\nAUTHP_ADMIN_SECRET=strong_password\n"})}),"\n",(0,t.jsx)(n.p,{children:"Token lifetime."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"AUTH_TOKEN_LIFETIME=3600\n"})}),"\n",(0,t.jsx)(n.h2,{id:"caddyfile",children:"Caddyfile"}),"\n",(0,t.jsxs)(n.p,{children:["Lets deep dive into the ",(0,t.jsx)(n.code,{children:"Caddyfile"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"First of all, you need to select one of our predefined setups."}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["We recommend using ",(0,t.jsx)(n.a,{href:"#full",children:"full security setup with MFA"})," for production environments where you will be issuing API-keys."]})}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsx)(n.p,{children:"You will able to login only via this path (REMNAWAVE_CUSTOM_LOGIN_ROUTE)."})}),"\n",(0,t.jsx)(n.h3,{id:"full",children:"Full security setup with MFA"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","All routes are protected by authentication. (Frontend, Backend)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","All API-endpoints are protected, includes /api/sub/* endpoints."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Login requires MFA with OTP-codes."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Special API-keys can be issued for /api/* endpoints."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Full domain protection."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Run the command below to download the Caddyfile."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -o Caddyfile https://raw.githubusercontent.com/remnawave/caddy-with-auth/refs/heads/main/examples/custom-webpath-with-auth-and-protected-api-route/Caddyfile\n"})}),"\n",(0,t.jsx)(n.h3,{id:"minimal",children:"API routes without auth (api/*)"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Routes are protected by authentication. (",(0,t.jsx)(n.strong,{children:"Frontend"}),")"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Login requires MFA with OTP-codes. (",(0,t.jsx)(n.strong,{children:"Frontend"}),")"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ",(0,t.jsx)(n.strong,{children:"All API-endpoints are not protected!"})," (/api/* is public)"]}),"\n"]}),"\n",(0,t.jsxs)(n.admonition,{type:"danger",children:[(0,t.jsxs)(n.p,{children:["This setup exposes the ",(0,t.jsx)(n.code,{children:"/api/*"})," endpoints to the public internet."]}),(0,t.jsx)(n.p,{children:"All endpoints will not require authentication, but will still use the Aura security features."}),(0,t.jsxs)(n.p,{children:["We recommend using ",(0,t.jsx)(n.a,{href:"#full",children:"full security setup with MFA"})," for production environments where you will be issuing API-keys."]})]}),"\n",(0,t.jsx)(n.p,{children:"Run the command below to download the Caddyfile."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -o Caddyfile https://raw.githubusercontent.com/remnawave/caddy-with-auth/refs/heads/main/examples/custom-webpath-with-auth-with-api-without-auth/Caddyfile\n"})}),"\n",(0,t.jsx)(n.h3,{id:"minimal-with-opened-sub",children:"/api/sub/* endpoints without auth"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Routes are protected by authentication. (",(0,t.jsx)(n.strong,{children:"Frontend"}),")"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Login requires MFA with OTP-codes. (",(0,t.jsx)(n.strong,{children:"Frontend"}),")"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Only ",(0,t.jsx)(n.code,{children:"/api/sub/*"})," endpoints is public, other endpoints are protected."]}),"\n"]}),"\n",(0,t.jsxs)(n.admonition,{type:"danger",children:[(0,t.jsxs)(n.p,{children:["This setup exposes the ",(0,t.jsx)(n.code,{children:"/api/sub/*"})," endpoints to the public internet."]}),(0,t.jsxs)(n.p,{children:["We recommend using ",(0,t.jsx)(n.a,{href:"#full",children:"full security setup with MFA"})," for production environments where you will be issuing API-keys and use ",(0,t.jsx)(n.a,{href:"/docs/install/aura-subscriptions",children:"@localzet/aura-subscriptions"})," for public subscription page."]})]}),"\n",(0,t.jsx)(n.p,{children:"Run the command below to download the Caddyfile."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -o Caddyfile https://raw.githubusercontent.com/remnawave/caddy-with-auth/refs/heads/main/examples/custom-webpath-with-auth-with-opened-api-sub/Caddyfile\n"})}),"\n",(0,t.jsx)(n.h2,{id:"running-the-container",children:"Running the container"}),"\n",(0,t.jsx)(n.p,{children:"After you have selected one of the setups above, you can start the container with the following command."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker compose up -d && docker compose logs -f\n"})}),"\n",(0,t.jsx)(n.h2,{id:"accessing-the-panel",children:"Accessing the panel"}),"\n",(0,t.jsxs)(n.p,{children:["After the container is running, you can access the panel at ",(0,t.jsx)(n.code,{children:"https://panel.domain.com/REMNAWAVE_CUSTOM_LOGIN_ROUTE"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"On the first start, you will be prompted to add a MFA method."}),"\n",(0,t.jsxs)(n.p,{children:["We recommend using ",(0,t.jsx)(n.a,{href:"https://www.google.com/search?q=google+authenticator",children:"Google Authenticator"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"disable-mfa",children:"Disable MFA"}),"\n",(0,t.jsxs)(n.p,{children:["If you want to completely disable MFA, you can do this by editing the ",(0,t.jsx)(n.code,{children:"Caddyfile"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Open the ",(0,t.jsx)(n.code,{children:"Caddyfile"})," and change the following line:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd /opt/aura/caddy && nano Caddyfile\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Find the following lines, and remove the ",(0,t.jsx)(n.code,{children:"require mfa"})," line."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-caddy",metastring:'title="Caddyfile"',children:"transform user {\r\n\tmatch origin local\r\n\taction add role authp/admin\r\n    // highlight-next-line-red\r\n\trequire mfa\r\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"After that, you can restart the container with the following command."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker compose down && docker compose up -d && docker compose logs -f\n"})}),"\n",(0,t.jsx)(n.h2,{id:"accessing-auth-portal-page",children:"Accessing Auth Portal page"}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["You can access the Auth Portal page at ",(0,t.jsx)(n.code,{children:"https://<your-domain>/REMNAWAVE_CUSTOM_LOGIN_ROUTE/auth"}),"."]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Auth Portal page",src:s(7427).A+"",width:"1920",height:"1440"})}),"\n",(0,t.jsx)(n.p,{children:"Here you can quickly go to the Aura dashboard or manage some of Auth Portal settings."}),"\n",(0,t.jsx)(n.p,{children:"In the MFA section, you can delete or add new MFA methods."}),"\n",(0,t.jsx)(n.h2,{id:"issuing-api-keys",children:"Issuing API-keys"}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["You can access the Auth Portal page at ",(0,t.jsx)(n.code,{children:"https://<your-domain>/REMNAWAVE_CUSTOM_LOGIN_ROUTE/auth"}),"."]})}),"\n",(0,t.jsxs)(n.p,{children:["On the Auth Portal page, you can issue API-keys, click on the ",(0,t.jsx)(n.code,{children:"API-keys"})," tab."]}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsxs)(n.p,{children:["After you issue an API-key, you can use it in the ",(0,t.jsx)(n.code,{children:"X-Api-Key"})," header of your requests to the API."]}),(0,t.jsxs)(n.p,{children:["Example: ",(0,t.jsx)(n.code,{children:"X-Api-Key: YxOovHLnpkcmSig5082egcHnyTk8SK4dNGAFHgZ2LKZezgj5oUj2FA2IR2sMwbALnP9YNpzZ"})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"API-keys",src:s(7459).A+"",width:"1920",height:"1440"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},7459:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/api-keys-c331e751c1f781e76cd82e4022a3e1ec.webp"},7427:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/auth-portal-3fa8b343ea3555c83b681dbfd5517429.webp"},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var i=s(6540);const t={},a=i.createContext(t);function l(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);