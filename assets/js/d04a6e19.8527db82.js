"use strict";(self.webpackChunk_localzet_aura_docs=self.webpackChunk_localzet_aura_docs||[]).push([[6255],{4544:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"features/receiving-webooks","title":"Receiving webhooks","description":"Overview","source":"@site/docs/features/receiving-webooks.md","sourceDirName":"features","slug":"/features/webhooks","permalink":"/docs/features/webhooks","draft":false,"unlisted":false,"editUrl":"https://github.com/localzet/aura-docs/tree/main/docs/features/receiving-webooks.md","tags":[],"version":"current","lastUpdatedBy":"Ivan Zorin","lastUpdatedAt":1750179473000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"slug":"/features/webhooks","title":"Receiving webhooks"},"sidebar":"tutorialSidebar","previous":{"title":"HWID device limit","permalink":"/docs/features/hwid-device-limit"},"next":{"title":"Telegram OAuth","permalink":"/docs/features/telegram-oauth"}}');var t=r(4848),i=r(8453);const d={sidebar_position:2,slug:"/features/webhooks",title:"Receiving webhooks"},o=void 0,a={},l=[{value:"Overview",id:"overview",level:2},{value:"Configuration",id:"configuration",level:2},{value:".env configuration",id:"env-configuration",level:3},{value:"Headers",id:"headers",level:3},{value:"Payload",id:"payload",level:3},{value:"Events",id:"events",level:3},{value:"User",id:"user",level:4},{value:"Node",id:"node",level:4},{value:"Service",id:"service",level:4},{value:"Verify webhook",id:"verify-webhook",level:2},{value:"Examples for different languages",id:"examples-for-different-languages",level:2},{value:"Python",id:"python",level:3},{value:"Go",id:"go",level:3}];function c(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Aura can send webhooks for many events."}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"env-configuration",children:".env configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"WEBHOOK_ENABLED=true\r\nWEBHOOK_URL=https://your-server.com/webhook\r\nWEBHOOK_SECRET_HEADER=your-secret-header\n"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"WEBHOOK_ENABLED"})}),(0,t.jsx)(n.td,{children:"Enable webhooks."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"WEBHOOK_URL"})}),(0,t.jsx)(n.td,{children:"The URL to send the webhook to. (must start with https:// or http://)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"WEBHOOK_SECRET_HEADER"})}),(0,t.jsx)(n.td,{children:"This header will be used to sign the webhook payload. (only aA-zZ, 0-9 are allowed)"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"headers",children:"Headers"}),"\n",(0,t.jsx)(n.p,{children:"Aura will send the following headers with the webhook payload:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"X-Aura-Signature"})," - The signature of the webhook payload. (signed with WEBHOOK_SECRET_HEADER)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"X-Aura-Timestamp"})," - The timestamp of the webhook payload."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"payload",children:"Payload"}),"\n",(0,t.jsx)(n.p,{children:"The payload will be a JSON object with the following fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"event"})," - The event that occurred."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"data"})," - The data associated with the event. Will contain full User, Node or Service object."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"timestamp"})," - The timestamp of the webhook payload."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"events",children:"Events"}),"\n",(0,t.jsx)(n.h4,{id:"user",children:"User"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.created"})," - The user was created."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.modified"})," - The user was modified."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.deleted"})," - The user was deleted."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.revoked"})," - The user was revoked."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.disabled"})," - The user was disabled."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.enabled"})," - The user was enabled."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.limited"})," - The user was limited."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.expired"})," - The user was expired."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.traffic_reset"})," - The user's traffic was reset."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.expires_in_72_hours"})," - The user's subscription will expire in 72 hours."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.expires_in_48_hours"})," - The user's subscription will expire in 48 hours."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.expires_in_24_hours"})," - The user's subscription will expire in 24 hours."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.expired_24_hours_ago"})," - The user's subscription expired 24 hours ago."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.first_connected"})," - The user connected to the node for the first time."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user.bandwidth_usage_threshold_reached"})," - The user's bandwidth usage threshold was reached."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"User payload will contain full User object."}),"\n",(0,t.jsxs)(r,{children:[(0,t.jsx)("summary",{children:"User object"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"uuid: string\r\nsubscriptionUuid: string\r\nshortUuid: string\r\nusername: string\r\nstatus: 'DISABLED' | 'LIMITED' | 'EXPIRED' | 'ACTIVE'\r\nusedTrafficBytes: string\r\nlifetimeUsedTrafficBytes: string\r\n\r\ntrafficLimitBytes: string\r\n\r\ntrafficLimitStrategy: 'NO_RESET' | 'DAY' | 'WEEK' | 'MONTH'\r\nsubLastUserAgent: string | null\r\nsubLastOpenedAt: string | null\r\n\r\nexpireAt: string\r\nonlineAt: string | null\r\nsubRevokedAt: string | null\r\nlastTrafficResetAt: string | null\r\n\r\ntrojanPassword: string\r\nvlessUuid: string\r\nssPassword: string\r\n\r\ndescription: null | string\r\ntelegramId: string | null\r\nemail: string | null\r\n\r\nhwidDeviceLimit: number | null\r\ncreatedAt: string\r\nupdatedAt: string\r\n\r\nfirstConnectedAt: string | null\r\nlastTriggeredThreshold: number\r\n\r\nactiveUserInbounds: Array<{\r\n    uuid: string\r\n    tag: string\r\n    type: string\r\n    network: string | null\r\n    security: string | null\r\n}>\n"})})]}),"\n",(0,t.jsx)(n.h4,{id:"node",children:"Node"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node.created"})," - Node was created."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node.modified"})," - Node was modified."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node.disabled"})," - Node was disabled."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node.enabled"})," - Node was enabled."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node.deleted"})," - Node was deleted."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node.connection_lost"})," - Node's connection was lost."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node.connection_restored"})," - Node's connection was restored."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node.traffic_notify"})," - Node reached the traffic notify limit."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Node payload will contain full Node object."}),"\n",(0,t.jsxs)(r,{children:[(0,t.jsx)("summary",{children:"Node object"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"uuid: string\r\nname: string\r\naddress: string\r\nport: null | number\r\nisConnected: boolean\r\nisConnecting: boolean\r\nisDisabled: boolean\r\nisNodeOnline: boolean\r\nisXrayRunning: boolean\r\nlastStatusChange: string | null\r\nlastStatusMessage: string | null\r\n\r\nxrayVersion: string | null\r\nxrayUptime: string\r\n\r\nusersOnline: number | null\r\n\r\nisTrafficTrackingActive: boolean\r\ntrafficResetDay: number | null\r\ntrafficLimitBytes: string | null\r\ntrafficUsedBytes: string | null\r\nnotifyPercent: number | null\r\n\r\nviewPosition: number\r\ncountryCode: string\r\nconsumptionMultiplier: string\r\n\r\ncpuCount: number | null\r\ncpuModel: string | null\r\ntotalRam: string | null\r\n\r\ncreatedAt: string\r\nupdatedAt: string\r\n\r\nexcludedInbounds: Array<{\r\n    uuid: string\r\n    tag: string\r\n    type: string\r\n    network: string | null\r\n    security: string | null\r\n}>\n"})})]}),"\n",(0,t.jsx)(n.h4,{id:"service",children:"Service"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"service.panel_started"})," - The service started."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"service.login_attempt_failed"})," - The login attempt failed."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"service.login_attempt_success"})," - The login attempt was successful."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Service payload will contain Service object."}),"\n",(0,t.jsxs)(r,{children:[(0,t.jsx)("summary",{children:"Service object"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"loginAttempt?: {\r\n    username: string\r\n    ip: string\r\n    userAgent: string\r\n    description?: string\r\n    password?: string\r\n}\n"})})]}),"\n",(0,t.jsx)(n.h2,{id:"verify-webhook",children:"Verify webhook"}),"\n",(0,t.jsxs)(n.p,{children:["Aura will sign the webhook payload with the ",(0,t.jsx)(n.code,{children:"WEBHOOK_SECRET_HEADER"})," and send it to the ",(0,t.jsx)(n.code,{children:"WEBHOOK_URL"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You can verify the webhook payload by checking the signature."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",metastring:'title="Webhook verification"',children:"export interface WebhookHeaders {\r\n\t'x-aura-signature': string\r\n\t'x-aura-timestamp': string\r\n}\r\n\r\nvalidateWebhook(data: {\r\n\tbody: unknown\r\n\theaders: WebhookHeaders\r\n}): boolean {\r\n\tif (!this.webhookSecret) return false\r\n\r\n\tconst signature = createHmac('sha256', this.webhookSecret)\r\n\t\t.update(JSON.stringify(data.body))\r\n\t\t.digest('hex')\r\n\r\n\treturn signature === data.headers['x-aura-signature']\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"examples-for-different-languages",children:"Examples for different languages"}),"\n",(0,t.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,t.jsxs)(r,{children:[(0,t.jsx)("summary",{children:"Python sample code"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'def validate_webhook(body, signature):\r\n    webhook_secret_panel = "your_secret_token"\r\n    """Validate webhook signature"""\r\n    if isinstance(body, str):\r\n        original_body = body\r\n        logging.warning("Body is string, parsing for logging...")\r\n        try:\r\n            parsed_body = json.loads(body)\r\n        except json.JSONDecodeError as e:\r\n            logging.warning("Failed to parse body: %s", e)\r\n            return False\r\n    else:\r\n        original_body = json.dumps(body, separators=(\',\', \':\'))\r\n        parsed_body = body\r\n\r\n    computed_signature = hmac.new(\r\n        webhook_secret_panel.encode(\'utf-8\'),\r\n        original_body.encode(\'utf-8\'),\r\n        hashlib.sha256\r\n    ).hexdigest()\r\n\r\n    return hmac.compare_digest(computed_signature, signature)\r\n\n'})})]}),"\n",(0,t.jsx)(n.h3,{id:"go",children:"Go"}),"\n",(0,t.jsxs)(r,{children:[(0,t.jsx)("summary",{children:"Go sample code"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "crypto/hmac"\r\n    "crypto/sha256"\r\n    "encoding/hex"\r\n    "encoding/json"\r\n    "fmt"\r\n    "io/ioutil"\r\n    "net/http"\r\n    "strings"\r\n)\r\n\r\nvar webhookSecret = "your-secret-header"\r\n\r\ntype WebhookPayload struct {\r\n    Event     string          `json:"event"`\r\n    Data      json.RawMessage `json:"data"`\r\n    Timestamp string          `json:"timestamp"`\r\n}\r\n\r\ntype UserData struct {\r\n    UUID            string `json:"uuid"`\r\n    Username        string `json:"username"`\r\n    Status          string `json:"status"`\r\n    UsedTrafficBytes string `json:"usedTrafficBytes"`\r\n    // Add other fields as needed\r\n}\r\n\r\ntype NodeData struct {\r\n    UUID        string `json:"uuid"`\r\n    Name        string `json:"name"`\r\n    IsConnected bool   `json:"isConnected"`\r\n    // Add other fields as needed\r\n}\r\n\r\nfunc validateWebhook(body []byte, signature string) bool {\r\n    mac := hmac.New(sha256.New, []byte(webhookSecret))\r\n    mac.Write(body)\r\n    expectedMAC := hex.EncodeToString(mac.Sum(nil))\r\n    return hmac.Equal([]byte(signature), []byte(expectedMAC))\r\n}\r\n\r\nfunc webhookHandler(w http.ResponseWriter, r *http.Request) {\r\n    // Read request body\r\n    body, err := ioutil.ReadAll(r.Body)\r\n    if err != nil {\r\n        http.Error(w, "Error reading request body", http.StatusBadRequest)\r\n        return\r\n    }\r\n\r\n    // Get headers\r\n    signature := r.Header.Get("X-Aura-Signature")\r\n    timestamp := r.Header.Get("X-Aura-Timestamp")\r\n\r\n    // Validate signature\r\n    if !validateWebhook(body, signature) {\r\n        http.Error(w, "Invalid signature", http.StatusUnauthorized)\r\n        return\r\n    }\r\n\r\n    // Parse payload\r\n    var payload WebhookPayload\r\n    if err := json.Unmarshal(body, &payload); err != nil {\r\n        http.Error(w, "Error parsing JSON", http.StatusBadRequest)\r\n        return\r\n    }\r\n\r\n    // Handle different events\r\n    if strings.HasPrefix(payload.Event, "user.") {\r\n        // Parse user data\r\n        var userData UserData\r\n        if err := json.Unmarshal(payload.Data, &userData); err != nil {\r\n            http.Error(w, "Error parsing user data", http.StatusBadRequest)\r\n            return\r\n        }\r\n\r\n        fmt.Printf("User event %s for %s\\n", payload.Event, userData.Username)\r\n\r\n        // Handle specific user events\r\n        switch payload.Event {\r\n        case "user.created":\r\n            // Handle user created\r\n        case "user.expired":\r\n            // Handle user expired\r\n        }\r\n    } else if strings.HasPrefix(payload.Event, "node.") {\r\n        // Parse node data\r\n        var nodeData NodeData\r\n        if err := json.Unmarshal(payload.Data, &nodeData); err != nil {\r\n            http.Error(w, "Error parsing node data", http.StatusBadRequest)\r\n            return\r\n        }\r\n\r\n        fmt.Printf("Node event %s for %s\\n", payload.Event, nodeData.Name)\r\n\r\n        // Handle specific node events\r\n        switch payload.Event {\r\n        case "node.connection_lost":\r\n            // Handle node connection lost\r\n        case "node.connection_restored":\r\n            // Handle node connection restored\r\n        }\r\n    }\r\n\r\n    w.WriteHeader(http.StatusOK)\r\n    w.Write([]byte("Webhook received"))\r\n}\r\n\r\nfunc main() {\r\n    http.HandleFunc("/webhook", webhookHandler)\r\n    fmt.Println("Server running at http://localhost:3000")\r\n    http.ListenAndServe(":3000", nil)\r\n}\n'})})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>o});var s=r(6540);const t={},i=s.createContext(t);function d(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);