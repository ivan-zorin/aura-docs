"use strict";(self.webpackChunk_localzet_aura_docs=self.webpackChunk_localzet_aura_docs||[]).push([[7746],{4313:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"install/reverse-proxies/traefik","title":"Traefik","description":"Battle-tested reverse proxy","source":"@site/docs/install/reverse-proxies/traefik.md","sourceDirName":"install/reverse-proxies","slug":"/install/reverse-proxies/traefik","permalink":"/docs/install/reverse-proxies/traefik","draft":false,"unlisted":false,"editUrl":"https://github.com/localzet/aura-docs/tree/main/docs/install/reverse-proxies/traefik.md","tags":[],"version":"current","lastUpdatedBy":"Ivan Zorin","lastUpdatedAt":1750179473000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Traefik","description":"Battle-tested reverse proxy"},"sidebar":"tutorialSidebar","previous":{"title":"Nginx","permalink":"/docs/install/reverse-proxies/nginx"},"next":{"title":"Try Cloudflare","permalink":"/docs/install/reverse-proxies/try-cloudflare"}}');var i=n(4848),s=n(8453),a=n(4499),o=n(4446);const l={sidebar_position:3,title:"Traefik",description:"Battle-tested reverse proxy"},c=void 0,d={},h=[{value:"Overview",id:"overview",level:2},...a.RM,{value:"Traefik configuration",id:"traefik-configuration",level:2},{value:"Create docker-compose.yml",id:"create-docker-composeyml",level:3},{value:"Create static configuration file",id:"create-static-configuration-file",level:3},{value:"Create dynamic configuration file",id:"create-dynamic-configuration-file",level:3},{value:"Start the container",id:"start-the-container",level:3},{value:"Restricting access to the panel by IP",id:"restricting-access-to-the-panel-by-ip",level:3},{value:"Allowing public access to the subscription path",id:"allowing-public-access-to-the-subscription-path",level:3},...o.RM];function p(e){const r={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(r.p,{children:"In this guide we will be using Traefik as a reverse proxy to access the Aura panel. We will point a domain name to our server and configure Traefik. Traefik will handle the issuance of SSL certificates by itself."}),"\n",(0,i.jsx)(a.Ay,{}),"\n",(0,i.jsx)(r.h2,{id:"traefik-configuration",children:"Traefik configuration"}),"\n",(0,i.jsx)(r.h3,{id:"create-docker-composeyml",children:"Create docker-compose.yml"}),"\n",(0,i.jsxs)(r.p,{children:["Create a ",(0,i.jsx)(r.code,{children:"docker-compose.yml"})," file in the ",(0,i.jsx)(r.code,{children:"/opt/aura/traefik"})," directory."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"mkdir -p /opt/aura/traefik && cd /opt/aura/traefik && nano docker-compose.yml\n"})}),"\n",(0,i.jsx)(r.p,{children:"Paste the following configuration."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:"services:\r\n    traefik:\r\n        image: traefik:latest\r\n        container_name: traefik\r\n        restart: unless-stopped\r\n        security_opt:\r\n            - no-new-privileges:true\r\n        networks:\r\n            - aura-network\r\n        ports:\r\n            - '0.0.0.0:80:80'\r\n            - '0.0.0.0:443:443'\r\n        environment:\r\n            - TZ=UTC\r\n        volumes:\r\n            - /var/run/docker.sock:/var/run/docker.sock:ro\r\n            - ./traefik.yml:/traefik.yml:ro\r\n            - ./letsencrypt:/letsencrypt\r\n            - ./config:/config:ro\r\n            - ./logs:/var/log/traefik\r\nnetworks:\r\n    aura-network:\r\n        name: aura-network\r\n        driver: bridge\r\n        external: false\n"})}),"\n",(0,i.jsx)(r.h3,{id:"create-static-configuration-file",children:"Create static configuration file"}),"\n",(0,i.jsxs)(r.p,{children:["Creating a static configuration file called ",(0,i.jsx)(r.code,{children:"traefik.yml"})," in the ",(0,i.jsx)(r.code,{children:"/opt/aura/traefik"})," directory."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"cd /opt/aura/traefik && nano traefik.yml\n"})}),"\n",(0,i.jsx)(r.p,{children:"Paste the following configuration."}),"\n",(0,i.jsxs)(r.admonition,{type:"warning",children:[(0,i.jsxs)(r.p,{children:["Please replace ",(0,i.jsx)(r.code,{children:"REPLACE_WITH_YOUR_EMAIL"})," with your email."]}),(0,i.jsx)(r.p,{children:"Review the configuration below, look for yellow highlighted lines."})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="traefik.yml"',children:'api:\r\n  dashboard: true\r\n  debug: true\r\nentryPoints:\r\n  http:\r\n    address: ":80"\r\n    http:\r\n      redirections:\r\n        entryPoint:\r\n          to: https\r\n          scheme: https\r\n  https:\r\n    address: ":443"\r\nserversTransport:\r\n  insecureSkipVerify: true\r\nproviders:\r\n  file:\r\n    directory: /config\r\n    watch: true\r\ncertificatesResolvers:\r\n  letsencrypt:\r\n    acme:\r\n      // highlight-next-line-yellow\r\n      email: REPLACE_WITH_YOUR_EMAIL\r\n      storage: /letsencrypt/acme.json\r\n      httpChallenge:\r\n        entryPoint: http\r\n\r\nlog:\r\n  level: "INFO"\r\n  filePath: "/var/log/traefik/traefik.log"\r\naccessLog:\r\n  filePath: "/var/log/traefik/access.log"\n'})}),"\n",(0,i.jsx)(r.h3,{id:"create-dynamic-configuration-file",children:"Create dynamic configuration file"}),"\n",(0,i.jsxs)(r.p,{children:["Create a file called ",(0,i.jsx)(r.code,{children:"aura.yml"})," in the ",(0,i.jsx)(r.code,{children:"/opt/aura/traefik/config"})," directory."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"mkdir -p /opt/aura/traefik/config && cd /opt/aura/traefik/config && nano aura.yml\n"})}),"\n",(0,i.jsx)(r.p,{children:"Paste the following configuration."}),"\n",(0,i.jsxs)(r.admonition,{type:"warning",children:[(0,i.jsxs)(r.p,{children:["Please replace ",(0,i.jsx)(r.code,{children:"REPLACE_WITH_YOUR_DOMAIN"})," with your domain name."]}),(0,i.jsx)(r.p,{children:"Review the configuration below, look for yellow highlighted lines."})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="aura.yml"',children:'http:\r\n  routers:\r\n    aura-backend:\r\n      // highlight-next-line-yellow\r\n      rule: "Host(`REPLACE_WITH_YOUR_DOMAIN`)"\r\n      entrypoints:\r\n        - http\r\n      middlewares:\r\n        - aura-https-redirect\r\n      service: aura\r\n\r\n    aura-secure:\r\n      // highlight-next-line-yellow\r\n      rule: "Host(`REPLACE_WITH_YOUR_DOMAIN`)"\r\n      entrypoints:\r\n        - https\r\n      middlewares:\r\n      tls:\r\n        certResolver: letsencrypt\r\n      service: aura\r\n\r\n  middlewares:\r\n    aura-https-redirect:\r\n      redirectScheme:\r\n        scheme: https\r\n\r\n  services:\r\n    aura-backend:\r\n      loadBalancer:\r\n        servers:\r\n          - url: "http://aura-backend:3000"\n'})}),"\n",(0,i.jsx)(r.h3,{id:"start-the-container",children:"Start the container"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"docker compose up -d && docker compose logs -f -t\n"})}),"\n",(0,i.jsx)(r.h3,{id:"restricting-access-to-the-panel-by-ip",children:"Restricting access to the panel by IP"}),"\n",(0,i.jsxs)(r.p,{children:["If you want to restrict access to the panel by IP, you can create a middleware file named ",(0,i.jsx)(r.code,{children:"ip_allow_list.yml"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"cd /opt/aura/traefik/config && nano ip_allow_list.yml\n"})}),"\n",(0,i.jsx)(r.p,{children:"Paste the following configuration."}),"\n",(0,i.jsxs)(r.admonition,{type:"warning",children:[(0,i.jsxs)(r.p,{children:["Please replace ",(0,i.jsx)(r.code,{children:"REPLACE_WITH_YOUR_IP"})," with your allowed IP address (or ranges of allowed IPs by using CIDR notation)."]}),(0,i.jsx)(r.p,{children:"Review the configuration below, look for yellow highlighted lines."})]}),"\n",(0,i.jsxs)(r.admonition,{type:"info",children:[(0,i.jsxs)(r.p,{children:["If your domain name is proxied by Cloudflare, then you need to specify the IP ranges belonging to Cloudflare in the ",(0,i.jsx)(r.code,{children:"excludedIPs"})," list."]}),(0,i.jsxs)(r.p,{children:["Cloudflare regularly updates its IP ranges so it's a good practice to use the ",(0,i.jsx)(r.a,{href:"https://www.cloudflare.com/ips/",children:"official Cloudflare page"})," to make sure that you have an up-to-date list."]})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="ip_allow_list.yml"',children:'http:\r\n    middlewares:\r\n        ip-allow-list:\r\n            ipAllowList:\r\n                sourceRange:\r\n                // highlight-next-line-yellow\r\n                    - "REPLACE_WITH_YOUR_IP"\r\n                ipStrategy:\r\n                    excludedIPs:\r\n                        - 73.245.48.0/20\r\n                        - 103.21.244.0/22\r\n                        - 103.22.200.0/22\r\n                        - 103.31.4.0/22\r\n                        - 141.101.64.0/18\r\n                        - 108.162.192.0/18\r\n                        - 190.93.240.0/20\r\n                        - 188.114.96.0/20\r\n                        - 197.234.240.0/22\r\n                        - 198.41.128.0/17\r\n                        - 162.158.0.0/15\r\n                        - 104.16.0.0/13\r\n                        - 104.24.0.0/14\r\n                        - 172.64.0.0/13\r\n                        - 131.0.72.0/22\n'})}),"\n",(0,i.jsxs)(r.p,{children:["Then you need to add the middleware ",(0,i.jsx)(r.code,{children:"ip-allow-list"})," to the ",(0,i.jsx)(r.code,{children:"aura.yml"})," configuration file."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"nano aura.yml\n"})}),"\n",(0,i.jsx)(r.p,{children:"Pay attention to the green line which is the one you need to add."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="aura.yml"',children:"http:\r\n    routers:\r\n      aura-backend:\r\n            rule: 'Host(`REPLACE_WITH_YOUR_DOMAIN`)'\r\n            entrypoints:\r\n                - http\r\n            middlewares:\r\n                - aura-https-redirect\r\n            service: aura\r\n\r\n        aura-secure:\r\n            rule: 'Host(`REPLACE_WITH_YOUR_DOMAIN`)'\r\n            entrypoints:\r\n                - https\r\n            middlewares:\r\n            // highlight-next-line-green\r\n                - ip-allow-list\r\n            tls:\r\n                certResolver: letsencrypt\r\n            service: aura\r\n\r\n    middlewares:\r\n        aura-https-redirect:\r\n            redirectScheme:\r\n                scheme: https\r\n\r\n    services:\r\n      aura-backend:\r\n            loadBalancer:\r\n                servers:\r\n                    - url: 'http://aura-backend:3000'\n"})}),"\n",(0,i.jsx)(r.h3,{id:"allowing-public-access-to-the-subscription-path",children:"Allowing public access to the subscription path"}),"\n",(0,i.jsxs)(r.p,{children:["For the subscription system to work correctly, the ",(0,i.jsx)(r.code,{children:"/api/sub/"})," path must be publicly accessible.",(0,i.jsx)(r.br,{}),"\n","At the same time, the rest of the panel should remain protected by IP-based restrictions."]}),"\n",(0,i.jsxs)(r.p,{children:["To achieve this, you need to define two separate routers for the same domain \u2014 one for ",(0,i.jsx)(r.code,{children:"/api/sub/"})," (open access), and one for everything else (restricted)."]}),"\n",(0,i.jsxs)(r.p,{children:["Open the file ",(0,i.jsx)(r.code,{children:"aura.yml"})," again:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"nano /opt/aura/traefik/config/aura.yml\n"})}),"\n",(0,i.jsx)(r.p,{children:"And update the router configuration as follows:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="aura.yml"',children:'http:\r\n  routers:\r\n    aura-sub:\r\n      // highlight-next-line-yellow\r\n      rule: "Host(`REPLACE_WITH_YOUR_DOMAIN`) && PathPrefix(`/api/sub/`)"\r\n      entrypoints:\r\n        - https\r\n      service: aura\r\n      tls:\r\n        certResolver: letsencrypt\r\n\r\n    aura-secure:\r\n      // highlight-next-line-yellow\r\n      rule: "Host(`REPLACE_WITH_YOUR_DOMAIN`)"\r\n      entrypoints:\r\n        - https\r\n      middlewares:\r\n        // highlight-next-line-green\r\n        - ip-allow-list\r\n      service: remnawave\r\n      tls:\r\n        certResolver: letsencrypt\r\n\r\n  middlewares:\r\n    remnawave-https-redirect:\r\n      redirectScheme:\r\n        scheme: https\r\n\r\n  services:\r\n    aura-backend:\r\n      loadBalancer:\r\n        servers:\r\n          - url: "http://aura-backend:3000"\n'})}),"\n",(0,i.jsxs)(r.p,{children:["This configuration makes the ",(0,i.jsx)(r.code,{children:"/api/sub/"})," path publicly accessible, while the rest of the panel remains IP-restricted."]}),"\n",(0,i.jsx)(o.Ay,{})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},4446:(e,r,n)=>{n.d(r,{Ay:()=>o,RM:()=>s});var t=n(4848),i=n(8453);const s=[{value:"Open the panel in the browser",id:"open-the-panel-in-the-browser",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2}];function a(e){const r={h2:"h2",h3:"h3",img:"img",p:"p",...(0,i.R)(),...e.components},{Button:s}=r;return s||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Button",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h3,{id:"open-the-panel-in-the-browser",children:"Open the panel in the browser"}),"\n",(0,t.jsx)(r.p,{children:"Open the configured domain name in the browser and you will see the login page."}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"login-page",src:n(3935).A+"",width:"960",height:"720"})}),"\n",(0,t.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(s,{label:"Ask community",link:"https://t.me/+YxzE4bOmEog2Zjhi",variant:"secondary",size:"md",outline:!0,style:{marginBottom:"1rem"}})]})}function o(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},4499:(e,r,n)=>{n.d(r,{Ay:()=>o,RM:()=>s});var t=n(4848),i=n(8453);const s=[{value:"Point domain to your server",id:"point-domain-to-your-server",level:2},{value:"DNS provider",id:"dns-provider",level:3}];function a(e){const r={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.admonition,{type:"warning",children:(0,t.jsx)(r.p,{children:"You need to have a registered domain name to continue."})}),"\n",(0,t.jsx)(r.h2,{id:"point-domain-to-your-server",children:"Point domain to your server"}),"\n",(0,t.jsx)(r.p,{children:"Check your server's IP address. It is better to use a static IPv4 address."}),"\n",(0,t.jsx)(r.p,{children:"Now, you need to point your domain name to this IP address."}),"\n",(0,t.jsxs)(r.p,{children:["For example, it will be ",(0,t.jsx)(r.code,{children:"my-super-panel.com"})," -> ",(0,t.jsx)(r.code,{children:"193.122.122.122"}),"."]}),"\n",(0,t.jsx)(r.p,{children:"There are two ways to do this:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Use a DNS provider (e.g. Cloudflare, Google Cloud, etc.)"}),"\n",(0,t.jsx)(r.li,{children:"Use a registrar (e.g. Namecheap, etc.)"}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"dns-provider",children:"DNS provider"}),"\n",(0,t.jsx)(r.p,{children:"If you are using Cloudflare, you need to add a A/AAAA record (for IPv4 and IPv6 respectively) to your DNS records."}),"\n",(0,t.jsxs)(r.p,{children:["Log in to your Cloudflare account ",(0,t.jsx)(r.a,{href:"https://dash.cloudflare.com/login",children:"here"})," and select the desired domain."]}),"\n",(0,t.jsxs)(r.p,{children:["On the left side of the page, click on ",(0,t.jsx)(r.code,{children:"DNS"})," and then click on ",(0,t.jsx)(r.code,{children:"Records"}),". Click on ",(0,t.jsx)(r.code,{children:"Create record"}),".",(0,t.jsx)(r.br,{}),"\n","Set the ",(0,t.jsx)(r.code,{children:"Type"})," to ",(0,t.jsx)(r.code,{children:"A"})," and the ",(0,t.jsx)(r.code,{children:"Name"})," to ",(0,t.jsx)(r.code,{children:"@"}),"."]}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsxs)(r.p,{children:["If you want to use subdomains, you should enter the subdomain name (e.g. ",(0,t.jsx)(r.code,{children:"panel"}),") in the ",(0,t.jsx)(r.code,{children:"Name"})," field."]})}),"\n",(0,t.jsxs)(r.p,{children:["Enter your server's IP address in the ",(0,t.jsx)(r.code,{children:"IPv4 address"})," field. and click on ",(0,t.jsx)(r.code,{children:"Save"}),"."]}),"\n",(0,t.jsx)(r.p,{children:"Now you need to wait a while for the DNS records to be updated."}),"\n",(0,t.jsxs)(r.admonition,{type:"info",children:[(0,t.jsx)(r.p,{children:"There is a big difference between yellow cloud (domain is proxied by Cloudflare) and grey cloud (domain is not proxied by Cloudflare) in the Cloudflare control panel."}),(0,t.jsx)(r.p,{children:"If Cloudflare works fine in your region, it is better to proxy the domain through Cloudflare. (Yellow cloud)"})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"static",src:n(7789).A+"",width:"1246",height:"529"})}),"\n",(0,t.jsx)(r.p,{children:"Some DNS providers have a different interface, but the overall process is the same."})]})}function o(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},7789:(e,r,n)=>{n.d(r,{A:()=>t});const t=n.p+"assets/images/cloudflare-dns-bd3780300a96c4c5995bc0a9c86d21d9.webp"},3935:(e,r,n)=>{n.d(r,{A:()=>t});const t=n.p+"assets/images/login-page-6236b327e75fd1535d4c5f275eabbd20.webp"},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>o});var t=n(6540);const i={},s=t.createContext(i);function a(e){const r=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);