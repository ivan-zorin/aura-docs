"use strict";(self.webpackChunk_localzet_aura_docs=self.webpackChunk_localzet_aura_docs||[]).push([[4017],{1386:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"install/panel-security/tinyAuth-for-nginx","title":"TinyAuth for Nginx","description":"TinyAuth is the simplest way to protect your apps with a login screen","source":"@site/docs/install/panel-security/tinyAuth-for-nginx.md","sourceDirName":"install/panel-security","slug":"/security/tinyauth-for-nginx","permalink":"/docs/security/tinyauth-for-nginx","draft":false,"unlisted":false,"editUrl":"https://github.com/localzet/aura-docs/tree/main/docs/install/panel-security/tinyAuth-for-nginx.md","tags":[],"version":"current","lastUpdatedBy":"Ivan Zorin","lastUpdatedAt":1750179473000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"slug":"/security/tinyauth-for-nginx","title":"TinyAuth for Nginx"},"sidebar":"tutorialSidebar","previous":{"title":"Cloudflare ZeroTrust","permalink":"/docs/security/cloudflare-zero-trust"},"next":{"title":"Upgrading","permalink":"/docs/install/upgrading"}}');var a=r(4848),s=r(8453);const i={sidebar_position:4,slug:"/security/tinyauth-for-nginx",title:"TinyAuth for Nginx"},o=void 0,c={},d=[{value:"Installation",id:"installation",level:2},{value:"Configuring variables",id:"configuring-variables",level:2},{value:"Configure",id:"configure",level:2},{value:"Running the container",id:"running-the-container",level:2},{value:"Issuing API-keys",id:"issuing-api-keys",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"TinyAuth is the simplest way to protect your apps with a login screen"}),"\n",(0,a.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(n.p,{children:"Now it's time to create our docker compose file which can be as simple as this:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:"tinyauth:\r\n    container_name: tinyauth\r\n    hostname: tinyauth\r\n    image: ghcr.io/maposia/remnawave-tinyauth:latest\r\n    restart: always\r\n    ports:\r\n      - '127.0.0.1:3002:3002'\r\n    networks:\r\n      - aura-network\r\n    environment:\r\n      - PORT=3002\r\n      - APP_URL=https://tinyauth.example.com\r\n      - USERS=your-username-password-hash\r\n      - SECRET=some-random-32-chars-string\r\n\r\n  # To get USERS and SECRET read below\r\n\n"})}),"\n",(0,a.jsx)(n.h2,{id:"configuring-variables",children:"Configuring variables"}),"\n",(0,a.jsx)(n.p,{children:"To generate your first hash for user, use the following command"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run -it --rm ghcr.io/maposia/remnawave-tinyauth:latest user create --interactive\n"})}),"\n",(0,a.jsxs)(n.p,{children:["After running, you will be prompted to enter a username and password. You will also need to select ",(0,a.jsx)("code",{children:"\r\noutput format"}),"-",(0,a.jsx)("code",{children:"docker"})]}),"\n",(0,a.jsxs)(n.p,{children:["After that, you will see a message that the user has been created and a ",(0,a.jsxs)("code",{children:["username",":passwordHash"]})," will appear which needs to be used in docker-compose.yml in the env ",(0,a.jsx)("code",{children:"USERS"})]}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.p,{children:"After you start the container, you can generate a hash for a user using the running tinyAuth container with the command."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker exec -it tinyauth ./tinyauth user create --interactive\n"})})]}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsxs)(n.p,{children:["Every configuration option that has a\xa0",(0,a.jsx)(n.code,{children:"FILE"}),"\xa0equivalent (e.g.\xa0",(0,a.jsx)(n.code,{children:"USERS"}),"\xa0and\xa0",(0,a.jsx)(n.code,{children:"USERS_FILE"}),"), then the file can be used instead of the environment variable."]}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"USERS="})," comma separated list of tinyauth users.",(0,a.jsx)(n.em,{children:"(required)"})]}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"USERS_FILE="})," A file containing a list of tinyauth users."]}),(0,a.jsxs)(n.p,{children:["All environment variables you can see on official documentation ",(0,a.jsx)(n.a,{href:"https://tinyauth.app/docs/reference/configuration.html",children:"https://tinyauth.app/docs/reference/configuration.html"})]})]}),"\n",(0,a.jsxs)(n.p,{children:["To generate the ",(0,a.jsx)("code",{children:"SECRET"})," environment variable using ",(0,a.jsx)("code",{children:"openssl rand -base64 32 | tr -dc 'a-zA-Z0-9' | head -c 32"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"configure",children:"Configure"}),"\n",(0,a.jsx)(n.p,{children:"Next, you need to configure nginx.conf to protect the required path."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-nginx",metastring:'title="nginx.conf"',children:'upstream tinyauth {\r\n    server 127.0.0.1:3002;\r\n}\r\n\r\n\r\nserver {\r\n    server_name tinyauth.example.com;\r\n    listen 443 ssl;\r\n    http2 on;\r\n\r\n    ssl_certificate "/etc/nginx/ssl/tinyauth.example.com/fullchain.pem";\r\n    ssl_certificate_key "/etc/nginx/ssl/tinyauth.example.com/privkey.pem";\r\n    ssl_trusted_certificate "/etc/nginx/ssl/tinyauth.example.com/fullchain.pem";\r\n\r\n    location / {\r\n        proxy_pass http://tinyauth;\r\n        proxy_set_header Host $host;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection $connection_upgrade;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n        proxy_set_header X-Forwarded-Host $host;\r\n        proxy_set_header X-Forwarded-Port $server_port;\r\n        proxy_send_timeout 60s;\r\n        proxy_read_timeout 60s;\r\n   }\r\n}\r\n\r\nserver {\r\n    server_name panel.remnawave.com;\r\n    listen 443 ssl;\r\n    http2 on;\r\n\r\n    ssl_certificate "/etc/nginx/ssl/panel.remnawave.com/fullchain.pem";\r\n    ssl_certificate_key "/etc/nginx/ssl/panel.remnawave.com/privkey.pem";\r\n    ssl_trusted_certificate "/etc/nginx/ssl/panel.remnawave.com/fullchain.pem";\r\n\r\n    location / {\r\n        auth_request /tinyauth;                         \r\n        error_page 401 = @tinyauth_login;\r\n\r\n        proxy_http_version 1.1;\r\n        proxy_pass http://aura-backend;\r\n        proxy_set_header Host $host;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection $connection_upgrade;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n        proxy_set_header X-Forwarded-Host $host;\r\n        proxy_set_header X-Forwarded-Port $server_port;\r\n        proxy_send_timeout 60s;\r\n        proxy_read_timeout 60s;\r\n    }\r\n\r\nlocation /tinyauth {\r\n  proxy_pass http://tinyauth/api/auth/nginx;\r\n\r\n  proxy_set_header x-forwarded-proto $scheme;\r\n  proxy_set_header x-forwarded-host $http_host;\r\n  proxy_set_header x-forwarded-uri $request_uri;\r\n}\r\n\r\n    location @tinyauth_login {\r\n    return 302 https://tinyauth.example.com/login?redirect_uri=$scheme://$http_host$request_uri; \r\n}\r\n\r\n#Make sure to replace the http://tinyauth.example.com with your own app URL\n'})}),"\n",(0,a.jsx)(n.h2,{id:"running-the-container",children:"Running the container"}),"\n",(0,a.jsx)(n.p,{children:"After that, restart nginx and launch tinyAuth"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose down && docker compose up -d && docker compose logs -f\n"})}),"\n",(0,a.jsx)(n.h2,{id:"issuing-api-keys",children:"Issuing API-keys"}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsxs)(n.p,{children:["You can use ",(0,a.jsxs)("code",{children:["Basic base64(username",":password",")"]})," in the ",(0,a.jsx)(n.code,{children:"X-Api-Key"})," header of your requests to the API."]}),(0,a.jsxs)(n.p,{children:["Example: ",(0,a.jsx)(n.code,{children:"X-Api-Key: Basic dXNlcm5hbWU6cGFzc3dvcmQ="})]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var t=r(6540);const a={},s=t.createContext(a);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);